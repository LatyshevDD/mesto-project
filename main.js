(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{E:()=>R,A:()=>Q});var t={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"902e7d86-3306-44b1-a025-c502f89e3c4a","Content-Type":"application/json"}},n=function(){return fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},r=function(){return fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},o=function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},c=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},u=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},a=document.querySelector(".elements"),i=a.querySelector(".elements__cards");function s(e){var t=e.target,o=t.closest(".elements__card").dataset.cardId;r().then((function(e){var r=e.find((function(e){return e._id==o})),a=r.likes;n().then((function(e){a.some((function(t){return t.name==e.name&&t.about==e.about}))?u(r._id).then((function(e){t.classList.remove("elements__like-button_active"),t.closest(".elements__card").querySelector(".elements__like-counter").textContent=e.likes.length})):c(r._id).then((function(e){t.classList.add("elements__like-button_active"),t.closest(".elements__card").querySelector(".elements__like-counter").textContent=e.likes.length}))})).catch((function(e){console.log(e)}))}))}function l(e){var t=e.target.closest(".elements__card");o(t.dataset.cardId).then((function(){t.remove()})).catch((function(e){console.log(e)}))}function d(e,t){var n=e.name,r=e.link,o=e._id,c=e.owner._id,u=document.querySelector(".cardTemplate").content.querySelector(".elements__card").cloneNode(!0),a=u.querySelector(".elements__image"),i=u.querySelector(".elements__close-button");return a.src=r,a.alt=n,u.dataset.cardId=o,u.querySelector(".elements__title").textContent=n,u.querySelector(".elements__like-button").addEventListener("click",s),i.addEventListener("click",l),a.addEventListener("click",(function(){F(q)})),function(e,t,n){e!=t&&n.classList.add("elements__close-button_disabled")}(t,c,i),u}function f(e,t,n){var r=e.querySelector(".form__input-error_".concat(t.id));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function _(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?f(e,t,n):function(e,t,n,r){var o=e.querySelector(".form__input-error_".concat(t.id));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}function p(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function m(e){for(var t=Array.from(e.querySelectorAll(".form__input-text")),n=0;n<t.length;n++)f(e,t[n],{inputErrorClass:"form__input-text_type_error",errorClass:"form__input-error_active"})}var y,v,h=document.querySelector(".profile"),S=h.querySelector(".profile__edit-button"),b=h.querySelector(".popup_type_edit-profile"),q=(b.querySelector(".popup__close-button"),document.querySelector(".popup_type_capture")),k=q.querySelector(".popup__capture"),E=(k.querySelector(".popup__capture-image"),k.querySelector(".popup__capture-title"),a.querySelector(".popup_type_add-card")),L=h.querySelector(".profile__add-button"),C=(E.querySelector(".popup__close-button"),E.querySelector(".form")),g=C.querySelector(".form__input-text_type_image-title"),j=C.querySelector(".form__input-text_type_image-link"),x=C.querySelector(".form__input-submit"),A=b.querySelector(".form"),P=A.querySelector(".form__input-text_type_name"),U=A.querySelector(".form__input-text_type_profession"),B=b.querySelector(".form__input-submit"),T=h.querySelector(".profile__name"),O=h.querySelector(".profile__profession"),D=h.querySelector(".profile__avatar-container"),w=h.querySelector(".profile__avatar"),N=(q.querySelector(".popup__close-button"),document.querySelector(".popup_type_edit-avatar")),I=N.querySelector(".form"),J=N.querySelector(".form__input-submit"),M=N.querySelector(".form__input-text_type_image-link");function H(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",V),e.removeEventListener("click",z)}function V(e){if("Escape"==e.key){var t=document.querySelector(".popup_opened");t&&H(t)}}function z(e){e.target.closest(".popup__container")||H(e.target.closest(".popup"))}function F(e){e.classList.add("popup_opened"),document.addEventListener("keydown",V),e.addEventListener("click",z)}function G(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function K(e,t,n){e.value=n?"Сохранение...":t}function Q(){n().then((function(e){T.textContent=e.name,O.textContent=e.about,w.src=e.avatar})).catch((function(e){console.log(e)}))}function R(){g.value="",j.value=""}Q(),y=Array.from(document.querySelectorAll(".popup")),Array.from(document.querySelectorAll(".popup__close-button")).forEach((function(e,t){e.addEventListener("click",(function(){H(y[t])}))})),L.addEventListener("click",(function(){g.value="",j.value="",F(E),m(C),p(x,{inactiveButtonClass:"form__input-submit_disabled"})})),D.addEventListener("click",(function(){M.value="",F(N),m(I),p(J,{inactiveButtonClass:"form__input-submit_disabled"})})),S.addEventListener("click",(function(){P.value=T.textContent,U.value=O.textContent,F(b),p(B,{inactiveButtonClass:"form__input-submit_disabled"})})),n().then((function(e){return e})).then((function(e){r().then((function(t){return t.forEach((function(t){i.prepend(d(t,e._id))})),t})).then((function(t){var n=Array.from(i.children);n.reverse(),t.forEach((function(t,r){t.likes.some((function(t){return t.name==e.name&&t.about==e.about}))&&n[r].querySelector(".elements__like-button").classList.add("elements__like-button_active")})),t.forEach((function(e,t){n[t].querySelector(".elements__like-counter").textContent=e.likes.length}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),C.addEventListener("submit",(function(e){e.preventDefault(),K(x,"Создать",!0),n().then((function(e){return e._id})).then((function(e){var n,r;(n=g.value,r=j.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",body:JSON.stringify({name:"".concat(n),link:"".concat(r)}),headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){i.prepend(d(t,e))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})).finally((function(){K(x,"Создать",!1),R(),H(E)}))})),A.addEventListener("submit",(function(e){var n,r;e.preventDefault(),K(B,"Сохранить",!0),(n=P.value,r=U.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",body:JSON.stringify({name:"".concat(n),about:"".concat(r)}),headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){Q()})).finally((function(){K(B,"Сохранить",!1),H(b)}))})),I.addEventListener("submit",(function(e){e.preventDefault();var n=M.value;K(J,"Сохранить",!0),function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:"".concat(e)}),headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(){Q()})).finally((function(){K(J,"Сохранить",!1),H(N)}))})),v={formSelector:".form",inputSelector:".form__input-text",submitButtonSelector:".form__input-submit",inactiveButtonClass:"form__input-submit_disabled",inputErrorClass:"form__input-text_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(v.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);G(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){_(e,o,t),G(n,r,t)}))}))}(e,v)})),S.addEventListener("click",(function(){for(var e=Array.from(A.querySelectorAll(v.inputSelector)),t=0;t<e.length;t++)_(A,e[t],v)}))})();