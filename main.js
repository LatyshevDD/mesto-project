(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}e.d({},{E:()=>G});var n={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"902e7d86-3306-44b1-a025-c502f89e3c4a","Content-Type":"application/json"}},r=document.querySelector(".elements"),o=r.querySelector(".elements__cards");function c(e,r){var o=e.name,c=e.link,i=e._id,a=e.owner._id,u=document.querySelector(".cardTemplate").content.querySelector(".elements__card").cloneNode(!0),l=u.querySelector(".elements__image"),s=u.querySelector(".elements__close-button"),_=u.querySelector(".elements__like-button"),d=u.querySelector(".elements__like-counter");return l.src=c,l.alt=o,u.querySelector(".elements__title").textContent=o,u.querySelector(".elements__like-button").addEventListener("click",(function(){!function(e,r,o){var c=r;c.likes.some((function(e){return e._id==o}))?function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:n.headers}).then((function(e){return t(e)}))}(c._id).then((function(t){e.classList.remove("elements__like-button_active"),e.closest(".elements__card").querySelector(".elements__like-counter").textContent=t.likes.length})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:n.headers}).then((function(e){return t(e)}))}(c._id).then((function(t){e.classList.add("elements__like-button_active"),e.closest(".elements__card").querySelector(".elements__like-counter").textContent=t.likes.length})).catch((function(e){console.log(e)}))}(_,e,r)})),s.addEventListener("click",(function(){!function(e,r){var o=e;(function(e){return fetch("".concat(n.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n.headers}).then((function(e){return t(e)}))})(r).then((function(){o.remove()})).catch((function(e){console.log(e)}))}(u,i)})),l.addEventListener("click",z),l.addEventListener("click",(function(){H(m)})),function(e,t,n){e!=t&&n.classList.add("elements__close-button_disabled")}(r,a,s),e.likes.some((function(e){return e._id==r}))&&_.classList.add("elements__like-button_active"),d.textContent=e.likes.length,u}function i(e,t,n){var r=e.querySelector(".form__input-error_".concat(t.id));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function a(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?i(e,t,n):function(e,t,n,r){var o=e.querySelector(".form__input-error_".concat(t.id));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}function u(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function l(e){for(var t=Array.from(e.querySelectorAll(".form__input-text")),n=0;n<t.length;n++)i(e,t[n],{inputErrorClass:"form__input-text_type_error",errorClass:"form__input-error_active"})}var s,_,d=document.querySelector(".profile"),f=d.querySelector(".profile__edit-button"),p=d.querySelector(".popup_type_edit-profile"),m=(p.querySelector(".popup__close-button"),document.querySelector(".popup_type_capture")),y=m.querySelector(".popup__capture"),v=y.querySelector(".popup__capture-image"),h=y.querySelector(".popup__capture-title"),S=r.querySelector(".popup_type_add-card"),b=d.querySelector(".profile__add-button"),q=(S.querySelector(".popup__close-button"),S.querySelector(".form")),k=q.querySelector(".form__input-text_type_image-title"),C=q.querySelector(".form__input-text_type_image-link"),E=q.querySelector(".form__input-submit"),L=p.querySelector(".form"),g=L.querySelector(".form__input-text_type_name"),x=L.querySelector(".form__input-text_type_profession"),A=p.querySelector(".form__input-submit"),U=d.querySelector(".profile__name"),B=d.querySelector(".profile__profession"),P=d.querySelector(".profile__avatar-container"),T=d.querySelector(".profile__avatar"),j=(m.querySelector(".popup__close-button"),document.querySelector(".popup_type_edit-avatar")),O=j.querySelector(".form"),w=j.querySelector(".form__input-submit"),D=j.querySelector(".form__input-text_type_image-link");function N(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",J),e.removeEventListener("click",M)}function J(e){if("Escape"==e.key){var t=document.querySelector(".popup_opened");t&&N(t)}}function M(e){e.target.closest(".popup__container")||N(e.target.closest(".popup"))}function H(e){e.classList.add("popup_opened"),document.addEventListener("keydown",J),e.addEventListener("click",M)}function V(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function z(e){var t=e.target;t.classList.contains("elements__image")&&(v.src=t.src,v.alt=t.alt,h.textContent=t.alt)}function F(e,t,n){e.value=n?"Сохранение...":t}function G(){k.value="",C.value=""}Promise.all([fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then((function(e){return t(e)})),fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){var t=e[0],n=e[1];U.textContent=t.name,B.textContent=t.about,T.src=t.avatar,n.forEach((function(e){o.prepend(c(e,t._id))}))})).catch((function(e){console.log(e)})),s=Array.from(document.querySelectorAll(".popup")),Array.from(document.querySelectorAll(".popup__close-button")).forEach((function(e,t){e.addEventListener("click",(function(){N(s[t])}))})),b.addEventListener("click",(function(){G(),H(S),l(q),u(E,{inactiveButtonClass:"form__input-submit_disabled"})})),P.addEventListener("click",(function(){D.value="",H(j),l(O),u(w,{inactiveButtonClass:"form__input-submit_disabled"})})),f.addEventListener("click",(function(){g.value=U.textContent,x.value=B.textContent,H(p),u(A,{inactiveButtonClass:"form__input-submit_disabled"})})),q.addEventListener("submit",(function(e){var r,i;e.preventDefault(),F(E,"Создать",!0),(r=k.value,i=C.value,fetch("".concat(n.baseUrl,"/cards"),{method:"POST",body:JSON.stringify({name:"".concat(r),link:"".concat(i)}),headers:n.headers}).then((function(e){return t(e)}))).then((function(e){o.prepend(c(e,e.owner._id)),N(S)})).catch((function(e){console.log(e)})).finally((function(){F(E,"Создать",!1),G()}))})),L.addEventListener("submit",(function(e){var r,o;e.preventDefault(),F(A,"Сохранить",!0),(r=g.value,o=x.value,fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",body:JSON.stringify({name:"".concat(r),about:"".concat(o)}),headers:n.headers}).then((function(e){return t(e)}))).then((function(e){U.textContent=e.name,B.textContent=e.about,N(p)})).catch((function(e){console.log(e)})).finally((function(){F(A,"Сохранить",!1)}))})),O.addEventListener("submit",(function(e){e.preventDefault();var r=D.value;F(w,"Сохранить",!0),function(e){return fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:"".concat(e)}),headers:n.headers}).then((function(e){return t(e)}))}(r).then((function(e){T.src=e.avatar,N(j)})).catch((function(e){console.log(e)})).finally((function(){F(w,"Сохранить",!1)}))})),_={formSelector:".form",inputSelector:".form__input-text",submitButtonSelector:".form__input-submit",inactiveButtonClass:"form__input-submit_disabled",inputErrorClass:"form__input-text_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(_.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);V(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){a(e,o,t),V(n,r,t)}))}))}(e,_)})),f.addEventListener("click",(function(){for(var e=Array.from(L.querySelectorAll(_.inputSelector)),t=0;t<e.length;t++)a(L,e[t],_)}))})();