(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{E:()=>Y,A:()=>X});var t={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"902e7d86-3306-44b1-a025-c502f89e3c4a","Content-Type":"application/json"}},n=function(){return fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},r=function(){return fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},o=function(e){return fetch("".concat(t.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},c=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},a=function(e){return fetch("".concat(t.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},u=document.querySelector(".elements"),i=u.querySelector(".elements__cards");function s(e){var t=e.target,o=t.closest(".elements__card").dataset.cardId;r().then((function(e){var r=e.find((function(e){return e._id==o})),u=r.likes;n().then((function(e){u.some((function(t){return t.name==e.name&&t.about==e.about}))?a(r._id).then((function(e){t.classList.remove("elements__like-button_active"),t.closest(".elements__card").querySelector(".elements__like-counter").textContent=e.likes.length})):c(r._id).then((function(e){t.classList.add("elements__like-button_active"),t.closest(".elements__card").querySelector(".elements__like-counter").textContent=e.likes.length}))})).catch((function(e){console.log(e)}))}))}function l(e){var t=e.target.closest(".elements__card");o(t.dataset.cardId).then((function(){t.remove()})).catch((function(e){console.log(e)}))}function d(e,t){var n=e.name,r=e.link,o=e._id,c=e.owner._id,a=document.querySelector(".cardTemplate").content.querySelector(".elements__card").cloneNode(!0),u=a.querySelector(".elements__image"),i=a.querySelector(".elements__close-button");return u.src=r,u.alt=n,a.dataset.cardId=o,a.querySelector(".elements__title").textContent=n,a.querySelector(".elements__like-button").addEventListener("click",s),i.addEventListener("click",l),u.addEventListener("click",R),u.addEventListener("click",(function(){K(q)})),function(e,t,n){e!=t&&n.classList.add("elements__close-button_disabled")}(t,c,i),a}function f(e,t,n){var r=e.querySelector(".form__input-error_".concat(t.id));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function _(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?f(e,t,n):function(e,t,n,r){var o=e.querySelector(".form__input-error_".concat(t.id));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}function m(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function p(e){for(var t=Array.from(e.querySelectorAll(".form__input-text")),n=0;n<t.length;n++)f(e,t[n],{inputErrorClass:"form__input-text_type_error",errorClass:"form__input-error_active"})}var y,v,h=document.querySelector(".profile"),S=h.querySelector(".profile__edit-button"),b=h.querySelector(".popup_type_edit-profile"),q=(b.querySelector(".popup__close-button"),document.querySelector(".popup_type_capture")),k=q.querySelector(".popup__capture"),E=k.querySelector(".popup__capture-image"),L=k.querySelector(".popup__capture-title"),C=u.querySelector(".popup_type_add-card"),g=h.querySelector(".profile__add-button"),x=(C.querySelector(".popup__close-button"),C.querySelector(".form")),j=x.querySelector(".form__input-text_type_image-title"),A=x.querySelector(".form__input-text_type_image-link"),P=x.querySelector(".form__input-submit"),U=b.querySelector(".form"),B=U.querySelector(".form__input-text_type_name"),T=U.querySelector(".form__input-text_type_profession"),O=b.querySelector(".form__input-submit"),D=h.querySelector(".profile__name"),w=h.querySelector(".profile__profession"),N=h.querySelector(".profile__avatar-container"),I=h.querySelector(".profile__avatar"),J=(q.querySelector(".popup__close-button"),document.querySelector(".popup_type_edit-avatar")),M=J.querySelector(".form"),H=J.querySelector(".form__input-submit"),V=J.querySelector(".form__input-text_type_image-link");function z(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",F),e.removeEventListener("click",G)}function F(e){if("Escape"==e.key){var t=document.querySelector(".popup_opened");t&&z(t)}}function G(e){e.target.closest(".popup__container")||z(e.target.closest(".popup"))}function K(e){e.classList.add("popup_opened"),document.addEventListener("keydown",F),e.addEventListener("click",G)}function Q(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function R(e){var t=e.target;t.classList.contains("elements__image")&&(E.src=t.src,E.alt=t.alt,L.textContent=t.alt)}function W(e,t,n){e.value=n?"Сохранение...":t}function X(){n().then((function(e){D.textContent=e.name,w.textContent=e.about,I.src=e.avatar})).catch((function(e){console.log(e)}))}function Y(){j.value="",A.value=""}X(),y=Array.from(document.querySelectorAll(".popup")),Array.from(document.querySelectorAll(".popup__close-button")).forEach((function(e,t){e.addEventListener("click",(function(){z(y[t])}))})),g.addEventListener("click",(function(){j.value="",A.value="",K(C),p(x),m(P,{inactiveButtonClass:"form__input-submit_disabled"})})),N.addEventListener("click",(function(){V.value="",K(J),p(M),m(H,{inactiveButtonClass:"form__input-submit_disabled"})})),S.addEventListener("click",(function(){B.value=D.textContent,T.value=w.textContent,K(b),m(O,{inactiveButtonClass:"form__input-submit_disabled"})})),n().then((function(e){return e})).then((function(e){r().then((function(t){return t.forEach((function(t){i.prepend(d(t,e._id))})),t})).then((function(t){var n=Array.from(i.children);n.reverse(),t.forEach((function(t,r){t.likes.some((function(t){return t.name==e.name&&t.about==e.about}))&&n[r].querySelector(".elements__like-button").classList.add("elements__like-button_active")})),t.forEach((function(e,t){n[t].querySelector(".elements__like-counter").textContent=e.likes.length}))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})),x.addEventListener("submit",(function(e){e.preventDefault(),W(P,"Создать",!0),n().then((function(e){return e._id})).then((function(e){var n,r;(n=j.value,r=A.value,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",body:JSON.stringify({name:"".concat(n),link:"".concat(r)}),headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(t){i.prepend(d(t,e))})).catch((function(e){console.log(e)}))})).catch((function(e){console.log(e)})).finally((function(){W(P,"Создать",!1),Y(),z(C)}))})),U.addEventListener("submit",(function(e){var n,r;e.preventDefault(),W(O,"Сохранить",!0),(n=B.value,r=T.value,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",body:JSON.stringify({name:"".concat(n),about:"".concat(r)}),headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){X()})).finally((function(){W(O,"Сохранить",!1),z(b)}))})),M.addEventListener("submit",(function(e){e.preventDefault();var n=V.value;W(H,"Сохранить",!0),function(e){return fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",body:JSON.stringify({avatar:"".concat(e)}),headers:t.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n).then((function(){X()})).finally((function(){W(H,"Сохранить",!1),z(J)}))})),v={formSelector:".form",inputSelector:".form__input-text",submitButtonSelector:".form__input-submit",inactiveButtonClass:"form__input-submit_disabled",inputErrorClass:"form__input-text_type_error",errorClass:"form__input-error_active"},Array.from(document.querySelectorAll(v.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);Q(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){_(e,o,t),Q(n,r,t)}))}))}(e,v)})),S.addEventListener("click",(function(){for(var e=Array.from(U.querySelectorAll(v.inputSelector)),t=0;t<e.length;t++)_(U,e[t],v)}))})();